---
title: "BIS-15L-Project"
author: "Eva Moncada"
date: "2024-03-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Installing the necessary packages

For this segment of the presentation, I will be using smoe basic packages as well as ggplot to create the graphs and ggmap to develop the maps. 
```{r}
#install.packages("RColorBrewer")
#install.packages("paletteer")
#install.packages("ggthemes")
#install.packages("ggmap")
#install.packages("extrafont")
```

# Loading the necessary libraries

```{r}
library("ggplot2")
library("naniar")
library("tidyverse")
library("janitor")
library("RColorBrewer")
library("paletteer")
library("lubridate")
library("ggmap")
library("patchwork")
library("extrafont")
```

# Loading the Crime Dataset

```{r}
original_crime_data <- read_csv("data/Crime_Data_from_2020_to_Present.csv") %>%
  clean_names()
```

##Cleaning the NAs
The NA's in this dataset are represented by blank cells.

```{r}
cleaned_crime <- original_crime_data %>%
  mutate_all(~ifelse(. == "", NA, .))
crime<-cleaned_crime
crime
```

Taking a look at the structure, dimensions, and name of the crime data.
```{r}
glimpse(cleaned_crime)
```

```{r}
dim(crime)
```

```{r}
names(crime)
```


# Which Age Group Commits the Most Crimes In Los Angeles County?

Presented on Slide 9 of the presentation, we will be observing which age group is shown to have commited the most crimes. Furthermore, we are interested in observing which crimes were committed the most by this age group. Lastly, the year with the most crimes may provide insight as to why the crimes may have been commited, however these are all hypothetical. 

## Determining the Most Common Age Group

```{r}
crime %>%
  group_by(vict_age) %>%
  summarise(crime_count = n()) %>%
  arrange(desc(crime_count))
```

vict_age = 0 most likely represents data that was not found and would be considered an NA. 

```{r}
cleaned_vict_age <- crime %>%
  na.omit(subset = c("vict_age")) %>% 
  mutate(age_group = cut(vict_age, breaks = seq(0, 100, by = 10), labels = FALSE))

crime_by_age_year <- cleaned_vict_age %>%
  group_by(year = lubridate::year(date_occ), age_group) %>%
  summarise(crime_count = n()) %>%
  arrange(desc(crime_count))

# Identify the most common and least common age groups for each year
most_common_age_group <- crime_by_age_year %>%
  group_by(year) %>%
  slice(1) %>%
  ungroup()

least_common_age_group <- crime_by_age_year %>%
  group_by(year) %>%
  slice_tail(n = 1) %>%
  ungroup()

# Bar plots for each year
bar_plots <- lapply(unique(crime_by_age_year$year), function(current_year) {
  ggplot(subset(crime_by_age_year, year == current_year), aes(x = as.factor(age_group), y = crime_count)) +
    geom_bar(stat = "identity", fill = "pink", color = "black") +
    labs(title = paste("Crime Distribution by Age Group - Year", current_year),
         x = "Age Group",
         y = "Crime Count") +
    theme_minimal()
})

```

##Plotting the Age Groups
```{r}
names(crime)
```
```{r}
crime$vict_age
```


```{r, fig.width=10, fig.height=6}
crime %>%
  filter(vict_age > 14) %>%
  group_by(vict_age) %>%
  summarise(crime_count = n()) %>%
  arrange(desc(crime_count)) %>%
  ggplot(aes(x = as.factor(vict_age), y = crime_count)) +
  geom_bar(stat = "identity", fill = "skyblue", color = "black") +  # Set a color, e.g., "skyblue"
  labs(title = "Crime Counts by Age Group",
       x = "Age Group",
       y = "Crime Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 6))
```

This lasrt graph loked a bit too intense. So, out of curiousity, I wanted to see how each age interval compare to each toher in the number of crime incidents committed. 

```{r}
crime %>%
  filter(vict_age > 14) %>%
  mutate(age_group = cut(vict_age, 
                        breaks = c(14, 20, 30, 40, 50, 60, 70, 80, 90, Inf), 
                        labels = c("14-19", "20-29", "30-39", "40-49", "50-59", "60-69", "70-79", "80-89", "90+"),
                        include.lowest = TRUE)) %>%
  group_by(age_group) %>%
  summarise(crime_count = n()) %>%
  arrange(desc(crime_count))
```

## Creating the plot
```{r}
crime %>%
  filter(vict_age > 14) %>%
  mutate(age_group = cut(vict_age, 
                        breaks = c(14, 20, 30, 40, 50, 60, 70, 80, 90, Inf), 
                        labels = c("14-19", "20-29", "30-39", "40-49", "50-59", "60-69", "70-79", "80-89", "90+"),
                        include.lowest = TRUE)) %>%
  group_by(age_group) %>%
  summarise(crime_count = n()) %>%
  arrange(desc(crime_count)) %>%
  ggplot(aes(x = age_group, y = crime_count, fill = age_group)) +
  geom_bar(stat = "identity", color = "black") +
  geom_text(aes(label = crime_count), vjust = -0.5, color = "black", size = 3, family = "Courier") +
  labs(title = "Crime Counts by Age Group",
       x = "Age Group",
       y = "Crime Count") +
  scale_fill_manual(values = c("#FFDAB9", "#D2B48C", "#FFA07A", "#FFE4C4", "#FFB6C1", "#FFD700", "#FAF0E6", "#FF6347", "#F5DEB3")) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 6), 
        panel.background = element_rect(fill = "#FDF7F6"),
        text = element_text(family = "Courier"),  
        legend.text = element_text(family = "Courier"),  
        legend.title = element_text(family = "Courier Bold")) +
  labs(fill = "Age Group")

```

As a group, it seemed like 20-29 year old as a whole committed the most number of crimes, though 30 year olds had the most when comparing individuals ages. 

# Observing which Crimes were Committed the Most by This Age Group

## What year was most of these crimes committed for 30 year olds? Is there a significant increase in one of the years? Why do you think that is?

```{r}
crime %>%
  filter(vict_age == 30) %>%
  mutate(year = year(mdy_hms(date_occ))) %>%
  group_by(year) %>%
  summarise(crime_count = n()) %>%
  arrange(desc(crime_count))
```
#Creating a separate column in the dataset for "year" so I can observe the changes per year. 

```{r}
crime <- crime %>%
  mutate(year_occurred = year(mdy_hms(date_occ)))
```

```{r}
crime
```

```{r}
crime %>%
  filter(vict_age >= 20, vict_age <= 29) %>%
  group_by(year_occurred) %>%
  summarise(crime_count = n()) %>%
  ggplot(aes(x = as.factor(year_occurred), y = crime_count, fill = as.factor(year_occurred))) +
  geom_bar(stat = "identity", color = "black") +
  geom_text(aes(label = crime_count), vjust = -0.5, color = "black", size = 3, family = "Courier") + 
  labs(title = "Crime Counts by 20-29 Year Olds Over Years",
       x = "Year",
       y = "Crime Count",
       fill = "Year") +
  scale_fill_manual(values = c("#FFDAB9", "#D2B48C", "#FFA07A", "#FFE4C4", "#FFB6C1", "#FFD700", "#FAF0E6", "#FF6347", "#F5DEB3")) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 6, family = "Courier"),
        panel.background = element_rect(fill = "#FDF7F6"),
        text = element_text(family = "Courier"),
        legend.text = element_text(family = "Courier"),  
        legend.title = element_text(family = "Courier Bold")) 

```


Individuals of 30 years of age have committed the most crimes in Los Angeles between 2020-2024, with 2022 being the most common. One of the reasons I wanted ot observe the year of which these crimes were committed is because I wanted to know whether COVID has made an impact on crime rates. 

Now choose: Since most crimes were committed in 2024, this is post-pandemic, thus a couple hypotheses may be that there is a lack of 

###Plotting the data

# Weaponry

One of the more interesting parts of observing crimes is analyzing the weapon of choice and what that weapon was used for. When determing the weapon of choice, connecting it to the most common crime type will allow us to deduce why that weapons was chosen. For example, in murders, are knives more common than guns? If yes, then why? Is it because it is easier to find in the common household/easier to get a hold of?

## Determining the Most Used Weapon

```{r}
crime %>%
  filter(vict_age >= 20, vict_age <= 29) %>%
  group_by(weapon_desc) %>%
  summarise(crime_count = n()) %>%
  arrange(desc(crime_count))
```

```{r, fig.width=15, fig.height=8}
crime_20_29 %>%
  group_by(crm_cd_desc) %>%
  summarise(crime_count = n(), .groups = 'drop') %>%
  arrange(desc(crime_count)) %>%
  slice_head(n = 20) %>%
  na.omit() %>% 
  ggplot(aes(x = reorder(crm_cd_desc, crime_count), y = crime_count, fill = crm_cd_desc)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = crime_count), vjust = -0.5, color = "black", size = 3, family = "Courier") +
  labs(title = "Top 20 Crimes Committed by 20-29 Year Olds",
       x = "Crime Description",
       y = "Crime Count",
       fill = "Crime Type") +
  scale_fill_manual(values = c("#FCEAE8", "#F8D7DA", "#FFDAB9", "#FFD700", "#D2B48C", "#FFA07A", "#FFE4C4", "#FFB6C1", "#CD853F", "#FFE4E1", "#FFC0CB", "#FFA07A", "#FF6347", "#E9967A", "#F4A460", "#8B4513", "#FFB90F", "#FFD700", "#FF6347", "#E9967A", "#FF4500")) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 6, family = "Courier"),
        panel.background = element_rect(fill = "#FDF7F6"),
        text = element_text(family = "Courier"),
        legend.text = element_text(family = "Courier"),
        legend.title = element_text(family = "Courier Bold"))

```

## What Crime was This Weapon Most Associated With?

```{r}

```

In this data, we see that knives were most commonly used of all the weapon types. More interestingly, we see that knives were also most used in THIS CRIME. WHY?

#Location

##Where were most of the crimes committed?



```{r}

```

